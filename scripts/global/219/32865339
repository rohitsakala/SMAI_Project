<p>I have 2 servers: NAS and outer one (let's call him mail server). NAS should generate information for employees and customers, crypt message, then send to mail server where message should be decrypted and send by PHP mail() function. My problem is that the same message is every time differentially decrypted:</p>  <p>Original: <strong>This is very important data</strong></p>  <p>Decrypted:</p>  <ol> <li>This is very impÅ‡wSÄšÃ³Å±wÃ‹$u!'6</li> <li>hÃMJaÃ,ÃÃ”ÄƒVË˜ortant data</li> <li>s|ÄšÄš'Ë‡SR0B%0GÄ†Å»~Å˜Ä½ÅÃ¤&amp;2Ãº</li> <li>sometimes it's proper 'This is very important data'</li> </ol>  <p>How to fix it?</p>  <p>my code:</p>  <p>part of user file:</p>  <pre><code>$td = mcrypt_module_open('twofish', '', 'cbc', ''); $iv = mcrypt_create_iv(mcrypt_enc_get_iv_size($td)); $key = substr(md5('mylittlepony').sha1('flutershyismylove'), 0, 31); mcrypt_generic_init($td, $key, $iv); $encrypted = mcrypt_generic($td, 'This is very important data'); echo message('my@mail.com', 'test', base64_encode($encrypted).'||'.base64_encode($iv)); </code></pre>  <p>File on mail server:</p>  <pre><code>$a = explode('||', $_POST[message]); $message = base64_decode($a[0]); $td = mcrypt_module_open('twofish', '', 'cbc', ''); $iv = base64_decode($a[1]); $key = substr(md5('mylittlepony').sha1('flutershyismylove'), 0, 31); mcrypt_generic_init($td, $key, $iv); $decrypted = mdecrypt_generic($td, $message); mcrypt_generic_deinit($td); mcrypt_module_close($td); $decrypted = trim($decrypted); mail($to, $_POST[subject], $decrypted, $_POST[headers]); </code></pre>  <p>message() is function which sends info by cURL to mail server.</p>